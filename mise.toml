[env]
_.file = "terraform/.env"

[tasks.set-project]
description = "Set gcloud project to ensure correct context"
run = """
gcloud config set project $TF_VAR_project_id
gcloud auth application-default set-quota-project $TF_VAR_project_id
"""

[tasks.logs]
description = "Read logs from the Actual server service"
depends = ["set-project"]
run = "gcloud run services logs read actual-server --region $TF_VAR_region --project $TF_VAR_project_id"

[tasks.setup-backup-cron]
description = "Set up daily backup cron job for Actual"
run = """
if ! crontab -l | grep -q "backup-actual.sh"; then
    (crontab -l ; echo "0 14 * * * $(pwd)/backup-actual.sh") | crontab -
fi
"""
